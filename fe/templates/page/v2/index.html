{% extends 'base2.html' %}
{% load static %}

{% block extra_css %}
{% endblock %}

{% block content %}
<div class="container-fluid p-0 pb-5 mb-5">
    <div id="header-carousel" class="carousel slide carousel-fade" data-ride="carousel">
        <ol class="carousel-indicators">
            <li data-target="#header-carousel" data-slide-to="0" class="active"></li>
            <li data-target="#header-carousel" data-slide-to="1"></li>
            <li data-target="#header-carousel" data-slide-to="2"></li>
        </ol>
        <div class="carousel-inner">
            <div class="carousel-item active" data-interval="2000" style="min-height: 300px;">
                <img class="position-relative w-100" src="{% static 'oc/img/carousel-1.jpg' %}" style="min-height: 300px; object-fit: cover;">
                <div class="carousel-caption d-flex align-items-center justify-content-center">
                    <div class="p-5" style="width: 100%; max-width: 900px;">
                        <h5 class="text-white text-uppercase mb-md-3">Simulasi Gelombang Cahaya</h5>
                        <h1 class="display-3 text-white mb-md-4">Periksa Gelombang Cahaya Dari Gambar</h1>
                    </div>
                </div>
            </div>
            <div class="carousel-item" data-interval="2000" style="min-height: 300px;">
                <img class="position-relative w-100" src="{% static 'oc/img/carousel-2.jpg' %}" style="min-height: 300px; object-fit: cover;">
                <div class="carousel-caption d-flex align-items-center justify-content-center">
                    <div class="p-5" style="width: 100%; max-width: 900px;">
                        <h5 class="text-white text-uppercase mb-md-3">Simulasi Gelombang Cahaya</h5>
                        <h1 class="display-3 text-white mb-md-4">Tinjau Materi Singkat Tentang Gelombang Cahaya</h1>
                    </div>
                </div>
            </div>
            <div class="carousel-item"  data-interval="2000" style="min-height: 300px;">
                <img class="position-relative w-100" src="{% static 'oc/img/carousel-3.jpg' %}" style="min-height: 300px; object-fit: cover;">
                <div class="carousel-caption d-flex align-items-center justify-content-center">
                    <div class="p-5" style="width: 100%; max-width: 900px;">
                        <h5 class="text-white text-uppercase mb-md-3">Simulasi Gelombang Cahaya</h5>
                        <h1 class="display-3 text-white mb-md-4">Ikuti Quiz Untuk Memperluas Wawasan</h1>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Carousel End -->


<!-- About Start -->
<div class="container-fluid py-5">
    <div class="container py-5">
        <div class="row align-items-center">
            <div class="col-lg-5">
                <img class="img-fluid rounded mb-4 mb-lg-0" src="{% static 'oc/img/about.jpg' %}" alt="">
            </div>
            <div class="col-lg-7">
                <div class="text-left mb-4">
                    <h5 class="text-primary text-uppercase mb-3" style="letter-spacing: 5px;">Tentang Website</h5>
                    <h1>Simulasi Gelombang Cahaya</h1>
                </div>
                <p style="text-align: justify;">Website ini dirancang untuk membaca spektrum warna dari cahaya tampak menggunakan file gambar yang diunggah oleh pengguna. Website ini memiliki fitur untuk pengguna dapat mengunggah gambar dan menyimpannya di database, kemudian sistem akan menganalisis spektrum warna yang terkandung dalam gambar tersebut. Dengan antarmuka yang intuitif dan mudah digunakan, website ini cocok untuk siapa saja yang ingin mempelajari distribusi warna dalam gambar secara visual dengan konsep sederhana. Proyek ini dibuat sebagai pembelajaran awal untuk menggabungkan teknologi spektrum warna dalam konteks yang sederhana namun bermanfaat.
                </p>
                <a href="/v2/materi/" class="btn btn-primary py-md-2 px-md-4 font-weight-semi-bold mt-2">Lihat Materi</a>
            </div>
        </div>
    </div>
</div>
<!-- About End -->


<!-- Category Start -->
<div class="container-fluid py-5">
    <div class="container pt-5 pb-3">
        <div class="text-center mb-5">
            <h5 class="text-primary text-uppercase mb-3" style="letter-spacing: 5px;">Fitur Website</h5>
        </div>
        <div class="row">
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="cat-item position-relative overflow-hidden rounded mb-2">
                    <img class="img-fluid" src="{% static 'oc/img/cat-1.jpg' %}" alt="">
                    <a class="cat-overlay text-white text-decoration-none" href="/v2/upload/">
                        <h4 class="text-white font-weight-medium">Upload</h4>
                    </a>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="cat-item position-relative overflow-hidden rounded mb-2">
                    <img class="img-fluid" src="{% static 'oc/img/cat-2.jpg' %}" alt="">
                    <a class="cat-overlay text-white text-decoration-none" href="/v2/review/">
                        <h4 class="text-white font-weight-medium">Review</h4>
                    </a>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="cat-item position-relative overflow-hidden rounded mb-2">
                    <img class="img-fluid" src="{% static 'oc/img/cat-3.jpg' %}" alt="">
                    <a class="cat-overlay text-white text-decoration-none" href="/v2/materi/">
                        <h4 class="text-white font-weight-medium">Materi</h4>
                    </a>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="cat-item position-relative overflow-hidden rounded mb-2">
                    <img class="img-fluid" src="{% static 'oc/img/cat-4.jpg' %}" alt="">
                    <a class="cat-overlay text-white text-decoration-none" href="/v2/quiz/">
                        <h4 class="text-white font-weight-medium">Quiz</h4>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Category Start -->


<!-- Registration Start -->
<div class="container-fluid bg-registration py-5" style="margin: 90px 0;">
    <div class="container py-5">
        <div class="row align-items-center">
            <div class="col-2"></div>
            <div class="col-8">
                <div class="card border-0">
                    <div class="card-header bg-light text-center p-4">
                        <h1 class="m-0">Beri Kita Masukan</h1>
                    </div>
                    <div class="card-body rounded-bottom bg-primary p-5">
                        <form id="commentForm">
                            <div class="form-group">
                                <input type="text" name="name" class="form-control border-0 p-4" placeholder="Your name" required="required" />
                            </div>
                            <div class="form-group">
                                <input type="email" name="email" class="form-control border-0 p-4" placeholder="Your email" required="required" />
                            </div>
                            <div class="form-group">
                                <textarea name="message" class="form-control border-0 p-4" placeholder="Your message" rows="5" required="required"></textarea>
                            </div>
                            <div>
                                <button class="btn btn-dark btn-block border-0 py-3" type="submit">Kirim Masukan</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-2"></div>
        </div>
    </div>
</div>
<!-- Registration End -->

<!-- Testimonial Start -->
<div class="container-fluid py-5">
    <div class="container py-5">
        <div class="text-center mb-5">
            <h5 class="text-primary text-uppercase mb-3" style="letter-spacing: 5px;">Testimonial</h5>
            <h1>Masukan Dari Netizen</h1>
        </div>
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="owl-carousel testimonial-carousel">
                    <!-- Testimonials will be dynamically appended here -->
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Testimonial End -->
{% endblock %}

{% block extra_js %}
<script>
    $(document).ready(function() {
        load_komen();

        $('#commentForm').on('submit', function(e) {
            e.preventDefault(); // Prevent the default form submission

            // Collect form data
            const formData = {
                nama: $('input[name="name"]').val(),
                email: $('input[name="email"]').val(),
                komentar: $('textarea[name="message"]').val()
            };

            // AJAX POST request
            $.ajax({
                url: '/core/api/v1/komentar/', // API endpoint
                type: 'POST',
                data: JSON.stringify(formData), // Convert to JSON string
                contentType: 'application/json', // Set correct content type
                success: function(response) {
                    alertSwal({
                        title: 'Berhasil Komentar',
                        text: 'Komentar Tersimpan.',
                        icon: 'success',
                        showConfirmButton: true, // Show a "OK" button to close manually
                    }).then(() => {
                        window.location.reload();
                    });
                },
                error: function(xhr, status, error) {
                    alertSwal({
                        title: 'Gagal Komentar',
                        text: 'Terjadi kesalahan.',
                        icon: 'error',
                        showConfirmButton: true, // Show a "OK" button to close manually
                    });
                    console.error(xhr.responseText);
                }
            });
        });
    });

    function load_komen() {
        $.ajax({
            url: '/core/api/v1/komentar/', // API endpoint
            type: 'GET',
            dataType: 'json',
            success: function (data) {
                // Sort by ID descending
                const sortedData = data.sort((a, b) => b.id - a.id);

                // Take the last 10 entries
                const latestTen = sortedData.slice(0, 10);

                // Clear any existing content before appending
                const $carousel = $('.testimonial-carousel');
                $carousel.empty();

                // Loop through the data and append to the testimonial carousel
                latestTen.forEach(item => {
                    const testimonialHtml = `
                        <div class="text-center">
                            <i class="fa fa-3x fa-quote-left text-primary mb-4"></i>
                            <h4 class="font-weight-normal mb-4">${item.komentar}</h4>
                            <h5 class="m-0">${item.nama}</h5>
                            <span>${item.email}</span>
                        </div>
                    `;
                    $carousel.append(testimonialHtml);
                });

                // Destroy any previously initialized Owl Carousel
                $carousel.trigger('destroy.owl.carousel');

                // Reinitialize Owl Carousel
                $carousel.owlCarousel({
                    items: 1,
                    loop: true,
                    autoplay: true,
                    autoplayTimeout: 5000,
                    dots: true,
                    nav: false,
                });
            },
            error: function (xhr, status, error) {
                console.error("Failed to fetch data: ", error);
            }
        });
    }
</script>
{% endblock %}
